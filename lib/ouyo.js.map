{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///ouyo.js","webpack:///webpack/bootstrap c36d6c916fdb32d97b33","webpack:///./src/utils.js","webpack:///./src/Key.js","webpack:///./src/Game.js","webpack:///./src/Entity.js","webpack:///./src/component.js","webpack:///./src/ticker.js","webpack:///./src/Query.js","webpack:///./src/IndexedArray.js"],"names":["root","factory","exports","module","define","amd","self","this","modules","__webpack_require__","moduleId","installedModules","i","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","__webpack_exports__","map","array","fn","result","length","forEach","forEach2","a","b","aItem","j","assert","condition","errorMessage","Error","_classCallCheck","instance","Constructor","TypeError","Key","_createClass","defineProperties","target","props","descriptor","writable","key","protoProps","staticProps","KEY_BITS","POWERS","Math","pow","values","push","value","index","setBit","valueIndex","previousValue","other","currentValue","otherValue","__WEBPACK_IMPORTED_MODULE_0__Game__","__WEBPACK_IMPORTED_MODULE_1__Query__","createProcess","processEntity","entities","event","game","fallback","undefined","getEntities","query","Array","isArray","__WEBPACK_IMPORTED_MODULE_1__utils__","subQuery","handleEntityChange","entity","onChange","handleEntityRemove","onRemove","Game","__WEBPACK_IMPORTED_MODULE_0__Entity__","__WEBPACK_IMPORTED_MODULE_2__component__","__WEBPACK_IMPORTED_MODULE_3__ticker__","doNothing","_this","registerUpdate","arguments","changed","removed","systems","queries","events","eventTimes","componentCount","started","runtime","onEntityChange","_len","fields","_key","_this2","system","_registerSystem","unifiedSystem","on","process","_registerQuery","_this3","init","_this4","timeDelta","_update","_this5","emit","_runSystem","_this6","_getEventsFor","_handleChanges","filter","type","assemblage","now","lastTime","makeNullArray","size","Entity","__WEBPACK_IMPORTED_MODULE_0__Key__","onKeyChanged","id","_components","_changeAnnounced","_onKeyChanged","componentInstance","_id","_onChange","Component","component","unset","createComponent","body","field","exec","decorate","Function","constructor","defaultTicker","update","onAnimationFrame","window","requestAnimationFrame","Date","min","maxId","components","__WEBPACK_IMPORTED_MODULE_2__utils__","_ref2","Query","__WEBPACK_IMPORTED_MODULE_1__IndexedArray__","_entities","_one","_ref","set","isInQuery","has","matched","matches","put","remove","elements","IndexedArray","_indices","otherObject","pop"],"mappings":"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","file":"ouyo.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"OUYO\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"OUYO\"] = factory();\n\telse\n\t\troot[\"OUYO\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"OUYO\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"OUYO\"] = factory();\n\telse\n\t\troot[\"OUYO\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 2);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"d\"] = map;\n/* harmony export (immutable) */ __webpack_exports__[\"b\"] = forEach;\n/* harmony export (immutable) */ __webpack_exports__[\"c\"] = forEach2;\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = assert;\n/* unused harmony export xor */\nfunction map(array, fn) {\n  var result = [];\n  for (var i = 0; i < array.length; i++) {\n    result[i] = fn(array[i]);\n  }\n  return result;\n}\n\nfunction forEach(array, fn) {\n  for (var i = 0; i < array.length; i++) {\n    fn(array[i]);\n  }\n}\n\nfunction forEach2(a, b, fn) {\n  for (var i = 0; i < a.length; i++) {\n    var aItem = a[i];\n    for (var j = 0; j < b.length; j++) {\n      fn(aItem, b[j]);\n    }\n  }\n}\n\nfunction assert(condition, errorMessage) {\n  if (!condition) {\n    throw new Error(errorMessage);\n  }\n}\n\nfunction xor(a, b) {\n  return (a || b) && !(a && b);\n}\n\n/***/ }),\n/* 1 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Key; });\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar KEY_BITS = 31;\n\nvar POWERS = [];\nfor (var i = 0; i < KEY_BITS; i++) {\n  POWERS[i] = Math.pow(2, i);\n}\n\nvar Key = function () {\n  function Key(length) {\n    _classCallCheck(this, Key);\n\n    this.values = [];\n    for (var _i = 0; _i < length / KEY_BITS; _i++) {\n      this.values.push(0);\n    }\n  }\n\n  _createClass(Key, [{\n    key: \"set\",\n    value: function set(index) {\n      this.setBit(index, true);\n      return this;\n    }\n  }, {\n    key: \"unset\",\n    value: function unset(index) {\n      this.setBit(index, false);\n      return this;\n    }\n  }, {\n    key: \"setBit\",\n    value: function setBit(index, value) {\n      var valueIndex = 0;\n      while (index >= KEY_BITS) {\n        valueIndex++;\n        index -= KEY_BITS;\n      }\n\n      var previousValue = (this.values[valueIndex] & POWERS[index]) !== 0;\n      if (value && !previousValue) {\n        this.values[valueIndex] += POWERS[index];\n      } else if (!value && previousValue) {\n        this.values[valueIndex] -= POWERS[index];\n      }\n    }\n  }, {\n    key: \"matches\",\n    value: function matches(other) {\n      for (var _i2 = 0; _i2 < other.values.length; _i2++) {\n        var currentValue = this.values[_i2] || 0;\n        var otherValue = other.values[_i2];\n        if ((currentValue & otherValue) !== otherValue) {\n          return false;\n        }\n      }\n      return true;\n    }\n  }]);\n\n  return Key;\n}();\n\n/***/ }),\n/* 2 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Game__ = __webpack_require__(3);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Game\", function() { return __WEBPACK_IMPORTED_MODULE_0__Game__[\"a\"]; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Query__ = __webpack_require__(7);\n/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, \"Query\", function() { return __WEBPACK_IMPORTED_MODULE_1__Query__[\"a\"]; });\n\n\n\n/***/ }),\n/* 3 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Game; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Entity__ = __webpack_require__(4);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__utils__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__component__ = __webpack_require__(5);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__ticker__ = __webpack_require__(6);\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n\n\n\n\n\nvar doNothing = function doNothing() {};\n\nvar Game = function () {\n  function Game() {\n    var _this = this;\n\n    var registerUpdate = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : __WEBPACK_IMPORTED_MODULE_3__ticker__[\"a\" /* defaultTicker */];\n\n    _classCallCheck(this, Game);\n\n    this.changed = [];\n    this.removed = [];\n\n    this.systems = [];\n    this.queries = [];\n\n    this.events = [];\n    this.eventTimes = {};\n\n    this.componentCount = 0;\n\n    this.started = false;\n    this.runtime = 0;\n    this.registerUpdate = registerUpdate;\n    this.onEntityChange = function (entity) {\n      return _this.changed.push(entity);\n    };\n  }\n\n  _createClass(Game, [{\n    key: 'createComponent',\n    value: function createComponent() {\n      Object(__WEBPACK_IMPORTED_MODULE_1__utils__[\"a\" /* assert */])(!this.started, 'Cannot create component after the game was started.');\n\n      for (var _len = arguments.length, fields = Array(_len), _key = 0; _key < _len; _key++) {\n        fields[_key] = arguments[_key];\n      }\n\n      return Object(__WEBPACK_IMPORTED_MODULE_2__component__[\"a\" /* createComponent */])(fields, this.componentCount++);\n    }\n  }, {\n    key: 'registerSystems',\n    value: function registerSystems(systems) {\n      var _this2 = this;\n\n      Object(__WEBPACK_IMPORTED_MODULE_1__utils__[\"b\" /* forEach */])(systems, function (system) {\n        return _this2._registerSystem(system);\n      });\n    }\n  }, {\n    key: '_registerSystem',\n    value: function _registerSystem(system) {\n      Object(__WEBPACK_IMPORTED_MODULE_1__utils__[\"a\" /* assert */])(!this.started, 'Cannot register systems after the game was started.');\n\n      var unifiedSystem = {\n        query: system.query || [],\n        on: system.on,\n        process: system.process || createProcess(system.processEntity)\n      };\n\n      this.systems.push(unifiedSystem);\n      this._registerQuery(system.query);\n    }\n  }, {\n    key: '_registerQuery',\n    value: function _registerQuery(query) {\n      var _this3 = this;\n\n      if (Array.isArray(query)) {\n        Object(__WEBPACK_IMPORTED_MODULE_1__utils__[\"b\" /* forEach */])(query, function (subQuery) {\n          return _this3.queries.push(subQuery);\n        });\n      } else if (query) {\n        this.queries.push(query);\n      }\n    }\n  }, {\n    key: 'start',\n    value: function start(init) {\n      var _this4 = this;\n\n      Object(__WEBPACK_IMPORTED_MODULE_1__utils__[\"a\" /* assert */])(!this.started, 'A game can only be started once!');\n      this.started = true;\n\n      init(this);\n\n      this.registerUpdate(function (timeDelta) {\n        return _this4._update(timeDelta);\n      });\n    }\n  }, {\n    key: '_update',\n    value: function _update(timeDelta) {\n      var _this5 = this;\n\n      this.runtime += timeDelta;\n      this.events.length = 0;\n      this.emit('tick');\n      Object(__WEBPACK_IMPORTED_MODULE_1__utils__[\"b\" /* forEach */])(this.systems, function (system) {\n        return _this5._runSystem(system);\n      });\n    }\n  }, {\n    key: '_runSystem',\n    value: function _runSystem(system, timeDelta) {\n      var _this6 = this;\n\n      var events = this._getEventsFor(system);\n      Object(__WEBPACK_IMPORTED_MODULE_1__utils__[\"b\" /* forEach */])(events, function (event) {\n        _this6._handleChanges();\n        var entities = getEntities(system.query);\n        system.process(entities, event, _this6);\n      });\n    }\n  }, {\n    key: '_getEventsFor',\n    value: function _getEventsFor(system) {\n      if (!system.on) {\n        return [this.events[0]];\n      } else {\n        return this.events.filter(function (event) {\n          return event.type === system.on;\n        });\n      }\n    }\n  }, {\n    key: '_handleChanges',\n    value: function _handleChanges() {\n      Object(__WEBPACK_IMPORTED_MODULE_1__utils__[\"c\" /* forEach2 */])(this.changed, this.queries, handleEntityChange);\n      this.changed.length = 0;\n\n      Object(__WEBPACK_IMPORTED_MODULE_1__utils__[\"c\" /* forEach2 */])(this.removed, this.queries, handleEntityRemove);\n      this.removed.length = 0;\n    }\n  }, {\n    key: 'createEntity',\n    value: function createEntity() {\n      var assemblage = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : doNothing;\n\n      Object(__WEBPACK_IMPORTED_MODULE_1__utils__[\"a\" /* assert */])(this.started, 'Entities cannot be created before the game is started.');\n      var entity = new __WEBPACK_IMPORTED_MODULE_0__Entity__[\"a\" /* Entity */](this.componentCount, this.onEntityChange);\n      assemblage(entity);\n      return entity;\n    }\n  }, {\n    key: 'removeEntity',\n    value: function removeEntity(entity) {\n      Object(__WEBPACK_IMPORTED_MODULE_1__utils__[\"a\" /* assert */])(this.started, 'Entities cannot be removed before the game is started.');\n      this.removed.push(entity);\n    }\n  }, {\n    key: 'emit',\n    value: function emit(event) {\n      if (typeof event === 'string') {\n        event = { type: event };\n      }\n      var now = this.runtime;\n      var lastTime = fallback(this.eventTimes[event.type], now);\n      event.timeDelta = (now - lastTime) / 1000;\n      this.eventTimes[event.type] = now;\n      this.events.push(event);\n    }\n  }]);\n\n  return Game;\n}();\n\nfunction createProcess(processEntity) {\n  return function (entities, event, game) {\n    for (var i = 0; i < entities.length; ++i) {\n      processEntity(entities[i], event, game);\n    }\n  };\n}\n\nfunction fallback(value, fallback) {\n  return value !== undefined ? value : fallback;\n}\n\nfunction getEntities(query) {\n  if (Array.isArray(query)) {\n    return Object(__WEBPACK_IMPORTED_MODULE_1__utils__[\"d\" /* map */])(query, function (subQuery) {\n      return subQuery.entities;\n    });\n  } else {\n    return query.entities;\n  }\n}\n\nfunction handleEntityChange(entity, query) {\n  query.onChange(entity);\n}\n\nfunction handleEntityRemove(entity, query) {\n  query.onRemove(entity);\n}\n\n/***/ }),\n/* 4 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Entity; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Key__ = __webpack_require__(1);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__utils__ = __webpack_require__(0);\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n\n\n\nvar index = 0;\n\nvar Entity = function () {\n  function Entity(componentCount, onKeyChanged) {\n    _classCallCheck(this, Entity);\n\n    this.id = index++;\n\n    this.key = new __WEBPACK_IMPORTED_MODULE_0__Key__[\"a\" /* Key */](componentCount);\n    this._components = makeNullArray(componentCount);\n\n    this._changeAnnounced = false;\n    this._onKeyChanged = onKeyChanged;\n  }\n\n  _createClass(Entity, [{\n    key: 'add',\n    value: function add(componentInstance) {\n      var index = componentInstance._id;\n\n      Object(__WEBPACK_IMPORTED_MODULE_1__utils__[\"a\" /* assert */])(!this._components[index], 'Cannot add another instance of the same component.');\n      Object(__WEBPACK_IMPORTED_MODULE_1__utils__[\"a\" /* assert */])(index < this._components.length, 'Unknown component passed as argument.');\n\n      this.key.setBit(index, true);\n      this._components[index] = componentInstance;\n\n      this._onChange();\n      return this;\n    }\n  }, {\n    key: 'has',\n    value: function has(Component) {\n      return !!this._components[Component.id];\n    }\n  }, {\n    key: 'get',\n    value: function get(Component) {\n      var component = this._components[Component.id];\n      Object(__WEBPACK_IMPORTED_MODULE_1__utils__[\"a\" /* assert */])(component, 'Requested component is not present.');\n      return component;\n    }\n  }, {\n    key: 'remove',\n    value: function remove(Component) {\n      var index = Component.id;\n      var component = this._components[index];\n\n      Object(__WEBPACK_IMPORTED_MODULE_1__utils__[\"a\" /* assert */])(component, 'Cannot remove component instance, because it doesn\\'t  exist on target entity.');\n\n      this.key.unset(index);\n      this._components[index] = null;\n      this._onChange();\n      return this;\n    }\n  }, {\n    key: '_onChange',\n    value: function _onChange() {\n      if (!this._changeAnnounced) {\n        this._onKeyChanged(this);\n      }\n      this._changeAnnounced = true;\n    }\n  }, {\n    key: 'onChangeRegistered',\n    value: function onChangeRegistered() {\n      this._changeAnnounced = false;\n    }\n  }]);\n\n  return Entity;\n}();\n\nfunction makeNullArray(size) {\n  var array = [];\n  for (var i = 0; i < size; i++) {\n    array[i] = null;\n  }\n  return array;\n}\n\n/***/ }),\n/* 5 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = createComponent;\n/* unused harmony export decorate */\nfunction createComponent(fields, id) {\n  var body = '';\n  for (var i = 0; i < fields.length; i++) {\n    var field = fields[i];\n    if (/^[a-zA-Z]\\w*$/.exec(field)) {\n      body += 'this.' + field + '=' + field + ';';\n    } else {\n      throw new Error('Invalid identifier: ' + field);\n    }\n  }\n  /* eslint-disable no-new-func */\n  return decorate(new Function(fields, body), id);\n}\n\nfunction decorate(constructor, id) {\n  constructor.id = id;\n  constructor.prototype._id = id;\n  return constructor;\n}\n\n/***/ }),\n/* 6 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return defaultTicker; });\nvar defaultTicker = function defaultTicker(update) {\n  window.requestAnimationFrame(onAnimationFrame);\n  var lastTime = Date.now();\n  function onAnimationFrame() {\n    window.requestAnimationFrame(onAnimationFrame);\n    var now = Date.now();\n    update(Math.min(now - lastTime, 100));\n    lastTime = now;\n  }\n};\n\n/***/ }),\n/* 7 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Query; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Key__ = __webpack_require__(1);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__IndexedArray__ = __webpack_require__(8);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__utils__ = __webpack_require__(0);\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n\n\n\n\nvar Query = function () {\n  function Query() {\n    var _this = this;\n\n    _classCallCheck(this, Query);\n\n    this._entities = new __WEBPACK_IMPORTED_MODULE_1__IndexedArray__[\"a\" /* IndexedArray */]();\n    this._one = false;\n\n    for (var _len = arguments.length, components = Array(_len), _key = 0; _key < _len; _key++) {\n      components[_key] = arguments[_key];\n    }\n\n    this.key = new __WEBPACK_IMPORTED_MODULE_0__Key__[\"a\" /* Key */](maxId(components) + 1);\n    Object(__WEBPACK_IMPORTED_MODULE_2__utils__[\"b\" /* forEach */])(components, function (_ref) {\n      var id = _ref.id;\n      return _this.key.set(id);\n    });\n  }\n\n  _createClass(Query, [{\n    key: 'one',\n    value: function one() {\n      this._one = true;\n      return this;\n    }\n  }, {\n    key: 'onChange',\n    value: function onChange(entity) {\n      var isInQuery = this._entities.has(entity);\n      var matched = entity.key.matches(this.key);\n\n      if (!isInQuery && matched) {\n        this._entities.put(entity);\n      } else if (isInQuery && !matched) {\n        this._entities.remove(entity);\n      }\n    }\n  }, {\n    key: 'onRemove',\n    value: function onRemove(entity) {\n      this._entities.remove(entity);\n    }\n  }, {\n    key: 'entities',\n    get: function get() {\n      return this._one ? this._entities.elements[0] : this._entities.elements;\n    }\n  }]);\n\n  return Query;\n}();\n\nfunction maxId(components) {\n  var maxId = 0;\n  Object(__WEBPACK_IMPORTED_MODULE_2__utils__[\"b\" /* forEach */])(components, function (_ref2) {\n    var id = _ref2.id;\n    return id > maxId && (maxId = id);\n  });\n  return maxId;\n}\n\n/***/ }),\n/* 8 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return IndexedArray; });\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar IndexedArray = function () {\n  function IndexedArray() {\n    _classCallCheck(this, IndexedArray);\n\n    this._indices = {};\n    this.elements = [];\n  }\n\n  _createClass(IndexedArray, [{\n    key: \"put\",\n    value: function put(object) {\n      this._indices[object.id] = this.elements.length;\n      this.elements.push(object);\n    }\n  }, {\n    key: \"has\",\n    value: function has(object) {\n      return this._indices[object.id] !== undefined;\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(object) {\n      var index = this._indices[object.id];\n      if (index !== undefined) {\n        delete this._indices[object.id];\n        var otherObject = this.elements.pop();\n        if (otherObject.id !== object.id) {\n          this.elements[index] = otherObject;\n          this._indices[otherObject.id] = index;\n        }\n      }\n    }\n  }]);\n\n  return IndexedArray;\n}();\n\n/***/ })\n/******/ ]);\n});\n\n\n// WEBPACK FOOTER //\n// ouyo.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap c36d6c916fdb32d97b33","export function map (array, fn) {\n  let result = []\n  for (let i = 0; i < array.length; i++) {\n    result[i] = fn(array[i])\n  }\n  return result\n}\n\nexport function forEach (array, fn) {\n  for (let i = 0; i < array.length; i++) {\n    fn(array[i])\n  }\n}\n\nexport function forEach2 (a, b, fn) {\n  for (let i = 0; i < a.length; i++) {\n    let aItem = a[i]\n    for (let j = 0; j < b.length; j++) {\n      fn(aItem, b[j])\n    }\n  }\n}\n\nexport function assert (condition, errorMessage) {\n  if (!condition) {\n    throw new Error(errorMessage)\n  }\n}\n\nexport function xor (a, b) {\n  return (a || b) && !(a && b)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils.js","const KEY_BITS = 31\r\n\r\nconst POWERS = []\r\nfor (let i = 0; i < KEY_BITS; i++) {\r\n  POWERS[i] = 2 ** i\r\n}\r\n\r\nexport class Key {\r\n  constructor (length) {\r\n    this.values = []\r\n    for (let i = 0; i < length / KEY_BITS; i++) {\r\n      this.values.push(0)\r\n    }\r\n  }\r\n\r\n  set (index) {\r\n    this.setBit(index, true)\r\n    return this\r\n  }\r\n\r\n  unset (index) {\r\n    this.setBit(index, false)\r\n    return this\r\n  }\r\n\r\n  setBit (index, value) {\r\n    let valueIndex = 0\r\n    while (index >= KEY_BITS) {\r\n      valueIndex++\r\n      index -= KEY_BITS\r\n    }\r\n\r\n    const previousValue = (this.values[valueIndex] & POWERS[index]) !== 0\r\n    if (value && !previousValue) {\r\n      this.values[valueIndex] += POWERS[index]\r\n    } else if (!value && previousValue) {\r\n      this.values[valueIndex] -= POWERS[index]\r\n    }\r\n  }\r\n\r\n  matches (other) {\r\n    for (let i = 0; i < other.values.length; i++) {\r\n      const currentValue = this.values[i] || 0\r\n      const otherValue = other.values[i]\r\n      if ((currentValue & otherValue) !== otherValue) {\r\n        return false\r\n      }\r\n    }\r\n    return true\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/Key.js","import { Entity } from './Entity'\nimport { assert, map, forEach, forEach2 } from './utils'\nimport { createComponent } from './component'\nimport { defaultTicker } from './ticker'\n\nconst doNothing = () => {}\n\nexport class Game {\n  constructor (registerUpdate = defaultTicker) {\n    this.changed = []\n    this.removed = []\n\n    this.systems = []\n    this.queries = []\n\n    this.events = []\n    this.eventTimes = {}\n\n    this.componentCount = 0\n\n    this.started = false\n    this.runtime = 0\n    this.registerUpdate = registerUpdate\n    this.onEntityChange = entity => this.changed.push(entity)\n  }\n\n  createComponent (...fields) {\n    assert(!this.started, 'Cannot create component after the game was started.')\n    return createComponent(fields, this.componentCount++)\n  }\n\n  registerSystems (systems) {\n    forEach(systems, system => this._registerSystem(system))\n  }\n\n  _registerSystem (system) {\n    assert(!this.started, 'Cannot register systems after the game was started.')\n\n    const unifiedSystem = {\n      query: system.query || [],\n      on: system.on,\n      process: system.process || createProcess(system.processEntity)\n    }\n\n    this.systems.push(unifiedSystem)\n    this._registerQuery(system.query)\n  }\n\n  _registerQuery (query) {\n    if (Array.isArray(query)) {\n      forEach(query, subQuery => this.queries.push(subQuery))\n    } else if (query) {\n      this.queries.push(query)\n    }\n  }\n\n  start (init) {\n    assert(!this.started, 'A game can only be started once!')\n    this.started = true\n\n    init(this)\n\n    this.registerUpdate(timeDelta => this._update(timeDelta))\n  }\n\n  _update (timeDelta) {\n    this.runtime += timeDelta\n    this.events.length = 0\n    this.emit('tick')\n    forEach(this.systems, system => this._runSystem(system))\n  }\n\n  _runSystem (system, timeDelta) {\n    const events = this._getEventsFor(system)\n    forEach(events, event => {\n      this._handleChanges()\n      const entities = getEntities(system.query)\n      system.process(entities, event, this)\n    })\n  }\n\n  _getEventsFor (system) {\n    if (!system.on) {\n      return [this.events[0]]\n    } else {\n      return this.events.filter(event => event.type === system.on)\n    }\n  }\n\n  _handleChanges () {\n    forEach2(this.changed, this.queries, handleEntityChange)\n    this.changed.length = 0\n\n    forEach2(this.removed, this.queries, handleEntityRemove)\n    this.removed.length = 0\n  }\n\n  createEntity (assemblage = doNothing) {\n    assert(this.started, 'Entities cannot be created before the game is started.')\n    const entity = new Entity(this.componentCount, this.onEntityChange)\n    assemblage(entity)\n    return entity\n  }\n\n  removeEntity (entity) {\n    assert(this.started, 'Entities cannot be removed before the game is started.')\n    this.removed.push(entity)\n  }\n\n  emit (event) {\n    if (typeof event === 'string') {\n      event = { type: event }\n    }\n    const now = this.runtime\n    const lastTime = fallback(this.eventTimes[event.type], now)\n    event.timeDelta = (now - lastTime) / 1000\n    this.eventTimes[event.type] = now\n    this.events.push(event)\n  }\n}\n\nfunction createProcess (processEntity) {\n  return function (entities, event, game) {\n    for (let i = 0; i < entities.length; ++i) {\n      processEntity(entities[i], event, game)\n    }\n  }\n}\n\nfunction fallback (value, fallback) {\n  return value !== undefined ? value : fallback\n}\n\nfunction getEntities (query) {\n  if (Array.isArray(query)) {\n    return map(query, subQuery => subQuery.entities)\n  } else {\n    return query.entities\n  }\n}\n\nfunction handleEntityChange (entity, query) {\n  query.onChange(entity)\n}\n\nfunction handleEntityRemove (entity, query) {\n  query.onRemove(entity)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Game.js","import { Key } from './Key'\nimport { assert } from './utils'\n\nlet index = 0\n\nexport class Entity {\n  constructor (componentCount, onKeyChanged) {\n    this.id = index++\n\n    this.key = new Key(componentCount)\n    this._components = makeNullArray(componentCount)\n\n    this._changeAnnounced = false\n    this._onKeyChanged = onKeyChanged\n  }\n\n  add (componentInstance) {\n    const index = componentInstance._id\n\n    assert(!this._components[index], 'Cannot add another instance of the same component.')\n    assert(index < this._components.length, 'Unknown component passed as argument.')\n\n    this.key.setBit(index, true)\n    this._components[index] = componentInstance\n\n    this._onChange()\n    return this\n  }\n\n  has (Component) {\n    return !!this._components[Component.id]\n  }\n\n  get (Component) {\n    const component = this._components[Component.id]\n    assert(component, 'Requested component is not present.')\n    return component\n  }\n\n  remove (Component) {\n    const index = Component.id\n    const component = this._components[index]\n\n    assert(component, 'Cannot remove component instance, because it doesn\\'t  exist on target entity.')\n\n    this.key.unset(index)\n    this._components[index] = null\n    this._onChange()\n    return this\n  }\n\n  _onChange () {\n    if (!this._changeAnnounced) {\n      this._onKeyChanged(this)\n    }\n    this._changeAnnounced = true\n  }\n\n  onChangeRegistered () {\n    this._changeAnnounced = false\n  }\n}\n\nfunction makeNullArray (size) {\n  const array = []\n  for (let i = 0; i < size; i++) {\n    array[i] = null\n  }\n  return array\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Entity.js","export function createComponent (fields, id) {\n  let body = ''\n  for (let i = 0; i < fields.length; i++) {\n    let field = fields[i]\n    if (/^[a-zA-Z]\\w*$/.exec(field)) {\n      body += `this.${field}=${field};`\n    } else {\n      throw new Error('Invalid identifier: ' + field)\n    }\n  }\n  /* eslint-disable no-new-func */\n  return decorate(new Function(fields, body), id)\n}\n\nexport function decorate (constructor, id) {\n  constructor.id = id\n  constructor.prototype._id = id\n  return constructor\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/component.js","export const defaultTicker = function (update) {\n  window.requestAnimationFrame(onAnimationFrame)\n  let lastTime = Date.now()\n  function onAnimationFrame () {\n    window.requestAnimationFrame(onAnimationFrame)\n    let now = Date.now()\n    update(Math.min(now - lastTime, 100))\n    lastTime = now\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ticker.js","import { Key } from './Key'\nimport { IndexedArray } from './IndexedArray'\nimport { forEach } from './utils'\n\nexport class Query {\n  constructor (...components) {\n    this._entities = new IndexedArray()\n    this._one = false\n\n    this.key = new Key(maxId(components) + 1)\n    forEach(components, ({ id }) => this.key.set(id))\n  }\n\n  one () {\n    this._one = true\n    return this\n  }\n\n  get entities () {\n    return this._one\n      ? this._entities.elements[0]\n      : this._entities.elements\n  }\n\n  onChange (entity) {\n    const isInQuery = this._entities.has(entity)\n    const matched = entity.key.matches(this.key)\n\n    if (!isInQuery && matched) {\n      this._entities.put(entity)\n    } else if (isInQuery && !matched) {\n      this._entities.remove(entity)\n    }\n  }\n\n  onRemove (entity) {\n    this._entities.remove(entity)\n  }\n}\n\nfunction maxId (components) {\n  let maxId = 0\n  forEach(components, ({ id }) => id > maxId && (maxId = id))\n  return maxId\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Query.js","export class IndexedArray {\n  constructor () {\n    this._indices = {}\n    this.elements = []\n  }\n\n  put (object) {\n    this._indices[object.id] = this.elements.length\n    this.elements.push(object)\n  }\n\n  has (object) {\n    return this._indices[object.id] !== undefined\n  }\n\n  remove (object) {\n    const index = this._indices[object.id]\n    if (index !== undefined) {\n      delete this._indices[object.id]\n      const otherObject = this.elements.pop()\n      if (otherObject.id !== object.id) {\n        this.elements[index] = otherObject\n        this._indices[otherObject.id] = index\n      }\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/IndexedArray.js"],"sourceRoot":""}