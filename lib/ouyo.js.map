{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 8cbed08fb85c6df595ce","webpack:///./src/Key.js","webpack:///./src/utils.js","webpack:///./src/Entity.js","webpack:///./src/Events.js","webpack:///./src/IndexedArray.js","webpack:///./src/Query.js","webpack:///./src/component.js","webpack:///./src/ticker.js","webpack:///./src/Game.js","webpack:///./src/index.js"],"names":["KEY_BITS","POWERS","i","Key","length","values","push","index","setBit","value","valueIndex","previousValue","other","currentValue","otherValue","map","array","fn","result","filter","forEach","forEach2","a","b","aItem","j","assert","condition","errorMessage","Error","componentCount","onKeyChanged","id","key","_components","makeNullArray","_changeAnnounced","_onKeyChanged","componentInstance","_id","_onChange","Component","component","unset","size","_events","_eventTimes","event","time","type","lastTime","safeGet","timeDelta","eventType","e","fallback","undefined","IndexedArray","_indices","elements","object","otherObject","pop","_entities","_one","subQueries","components","maxId","set","entity","isInQuery","has","matched","matches","put","remove","queries","query","entities","emptyQuery","unifyQuery","Array","isArray","fields","body","isValid","field","decorate","Function","exec","constructor","prototype","defaultTicker","update","window","requestAnimationFrame","onAnimationFrame","Date","now","Math","min","onTick","_changed","_removed","_systems","_queries","_componentCount","_started","_time","_onTick","_onEntityChange","_proxy","createEntity","_createEntity","assemblage","removeEntity","_removeEntity","emit","_emit","createComponent","systems","registerSystem","system","on","process","createProcess","processEntity","subQuery","init","_update","clear","_runSystem","get","_handleChanges","handleEntityChange","handleEntityRemove","game","onChange","onRemove"],"mappings":"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","file":"ouyo.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"OUYO\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"OUYO\"] = factory();\n\telse\n\t\troot[\"OUYO\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 8cbed08fb85c6df595ce","const KEY_BITS = 31\r\n\r\nconst POWERS = []\r\nfor (let i = 0; i < KEY_BITS; i++) {\r\n  POWERS[i] = 2 ** i\r\n}\r\n\r\nexport class Key {\r\n  constructor (length) {\r\n    this.values = []\r\n    for (let i = 0; i < length / KEY_BITS; i++) {\r\n      this.values.push(0)\r\n    }\r\n  }\r\n\r\n  set (index) {\r\n    this.setBit(index, true)\r\n    return this\r\n  }\r\n\r\n  unset (index) {\r\n    this.setBit(index, false)\r\n    return this\r\n  }\r\n\r\n  setBit (index, value) {\r\n    let valueIndex = 0\r\n    while (index >= KEY_BITS) {\r\n      valueIndex++\r\n      index -= KEY_BITS\r\n    }\r\n\r\n    const previousValue = (this.values[valueIndex] & POWERS[index]) !== 0\r\n    if (value && !previousValue) {\r\n      this.values[valueIndex] += POWERS[index]\r\n    } else if (!value && previousValue) {\r\n      this.values[valueIndex] -= POWERS[index]\r\n    }\r\n  }\r\n\r\n  matches (other) {\r\n    for (let i = 0; i < other.values.length; i++) {\r\n      const currentValue = this.values[i] || 0\r\n      const otherValue = other.values[i]\r\n      if ((currentValue & otherValue) !== otherValue) {\r\n        return false\r\n      }\r\n    }\r\n    return true\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/Key.js","export function map (array, fn) {\n  let result = []\n  for (let i = 0; i < array.length; i++) {\n    result[i] = fn(array[i])\n  }\n  return result\n}\n\nexport function filter (array, fn) {\n  let result = []\n  for (let i = 0; i < array.length; i++) {\n    let value = array[i]\n    if (fn(value)) {\n      result.push(value)\n    }\n  }\n  return result\n}\n\nexport function forEach (array, fn) {\n  for (let i = 0; i < array.length; i++) {\n    fn(array[i])\n  }\n}\n\nexport function forEach2 (a, b, fn) {\n  for (let i = 0; i < a.length; i++) {\n    let aItem = a[i]\n    for (let j = 0; j < b.length; j++) {\n      fn(aItem, b[j])\n    }\n  }\n}\n\nexport function assert (condition, errorMessage) {\n  if (!condition) {\n    throw new Error(errorMessage)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils.js","import { Key } from './Key'\nimport { assert } from './utils'\n\nlet index = 0\n\nexport class Entity {\n  constructor (componentCount, onKeyChanged) {\n    this.id = index++\n\n    this.key = new Key(componentCount)\n    this._components = makeNullArray(componentCount)\n\n    this._changeAnnounced = false\n    this._onKeyChanged = onKeyChanged\n  }\n\n  add (componentInstance) {\n    const index = componentInstance._id\n\n    assert(!this._components[index], 'Cannot add another instance of the same component.')\n    assert(index < this._components.length, 'Unknown component passed as argument.')\n\n    this.key.setBit(index, true)\n    this._components[index] = componentInstance\n\n    this._onChange()\n    return this\n  }\n\n  has (Component) {\n    return !!this._components[Component.id]\n  }\n\n  get (Component) {\n    const component = this._components[Component.id]\n    assert(component, 'Requested component is not present.')\n    return component\n  }\n\n  remove (Component) {\n    const index = Component.id\n    const component = this._components[index]\n\n    assert(component, 'Cannot remove component instance, because it doesn\\'t  exist on target entity.')\n\n    this.key.unset(index)\n    this._components[index] = null\n    this._onChange()\n    return this\n  }\n\n  _onChange () {\n    if (!this._changeAnnounced) {\n      this._onKeyChanged(this)\n    }\n    this._changeAnnounced = true\n  }\n\n  onChangeRegistered () {\n    this._changeAnnounced = false\n  }\n}\n\nfunction makeNullArray (size) {\n  const array = []\n  for (let i = 0; i < size; i++) {\n    array[i] = null\n  }\n  return array\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Entity.js","import { filter } from './utils'\n\nexport class Events {\n  constructor () {\n    this._events = []\n    this._eventTimes = {}\n  }\n\n  emit (event, time) {\n    if (typeof event === 'string') {\n      event = { type: event }\n    }\n    const lastTime = safeGet(this._eventTimes[event.type], time)\n    event.timeDelta = (time - lastTime) / 1000\n    this._eventTimes[event.type] = time\n    this._events.push(event)\n  }\n\n  get (eventType) {\n    return filter(this._events, e => e.type === eventType)\n  }\n\n  clear () {\n    this._events.length = 0\n  }\n}\n\nfunction safeGet (value, fallback) {\n  return value !== undefined ? value : fallback\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Events.js","export class IndexedArray {\n  constructor () {\n    this._indices = {}\n    this.elements = []\n  }\n\n  put (object) {\n    this._indices[object.id] = this.elements.length\n    this.elements.push(object)\n  }\n\n  has (object) {\n    return this._indices[object.id] !== undefined\n  }\n\n  remove (object) {\n    const index = this._indices[object.id]\n    if (index !== undefined) {\n      delete this._indices[object.id]\n      const otherObject = this.elements.pop()\n      if (otherObject.id !== object.id) {\n        this.elements[index] = otherObject\n        this._indices[otherObject.id] = index\n      }\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/IndexedArray.js","import { Key } from './Key'\nimport { IndexedArray } from './IndexedArray'\nimport { forEach, map } from './utils'\n\nexport class Query {\n  constructor (...components) {\n    this._entities = new IndexedArray()\n    this._one = false\n\n    this.subQueries = [this]\n    this.key = new Key(maxId(components) + 1)\n    forEach(components, ({ id }) => this.key.set(id))\n  }\n\n  one () {\n    this._one = true\n    return this\n  }\n\n  get entities () {\n    return this._one\n      ? this._entities.elements[0]\n      : this._entities.elements\n  }\n\n  onChange (entity) {\n    const isInQuery = this._entities.has(entity)\n    const matched = entity.key.matches(this.key)\n\n    if (!isInQuery && matched) {\n      this._entities.put(entity)\n    } else if (isInQuery && !matched) {\n      this._entities.remove(entity)\n    }\n  }\n\n  onRemove (entity) {\n    this._entities.remove(entity)\n  }\n}\n\nfunction maxId (components) {\n  let maxId = 0\n  forEach(components, ({ id }) => id > maxId && (maxId = id))\n  return maxId\n}\n\nclass QueryArray {\n  constructor (queries) {\n    this.subQueries = queries\n  }\n\n  get entities () {\n    return map(this.subQueries, query => query.entities)\n  }\n}\n\nconst emptyQuery = {\n  entities: [],\n  subQueries: []\n}\n\nexport function unifyQuery (query = emptyQuery) {\n  return Array.isArray(query)\n    ? new QueryArray(query)\n    : query\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Query.js","import { forEach, assert } from './utils'\n\nexport function createComponent (fields, id) {\n  let body = ''\n  forEach(fields, field => {\n    assert(isValid(field), 'Invalid identifier: ' + field)\n    body += `this.${field}=${field};`\n  })\n  /* eslint-disable no-new-func */\n  return decorate(new Function(fields, body), id)\n}\n\nfunction isValid (field) {\n  return /^[a-zA-Z]\\w*$/.exec(field)\n}\n\nfunction decorate (constructor, id) {\n  constructor.id = id\n  constructor.prototype._id = id\n  return constructor\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/component.js","export const defaultTicker = function (update) {\n  window.requestAnimationFrame(onAnimationFrame)\n  let lastTime = Date.now()\n  function onAnimationFrame () {\n    window.requestAnimationFrame(onAnimationFrame)\n    let now = Date.now()\n    update(Math.min(now - lastTime, 100))\n    lastTime = now\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ticker.js","import { Entity } from './Entity'\nimport { Events } from './Events'\nimport { unifyQuery } from './Query'\nimport { assert, forEach, forEach2 } from './utils'\nimport { createComponent } from './component'\nimport { defaultTicker } from './ticker'\n\nexport class Game {\n  constructor (onTick = defaultTicker) {\n    this._changed = []\n    this._removed = []\n\n    this._systems = []\n    this._queries = []\n\n    this._events = new Events()\n\n    this._componentCount = 0\n\n    this._started = false\n    this._time = 0\n    this._onTick = onTick\n    this._onEntityChange = entity => this._changed.push(entity)\n\n    this._proxy = {\n      createEntity: assemblage => this._createEntity(assemblage),\n      removeEntity: entity => this._removeEntity(entity),\n      emit: event => this._emit(event)\n    }\n  }\n\n  createComponent (...fields) {\n    assert(!this._started, 'Cannot create component after the game was started.')\n    return createComponent(fields, this._componentCount++)\n  }\n\n  registerSystems (systems) {\n    forEach(systems, system => this.registerSystem(system))\n  }\n\n  registerSystem (system) {\n    assert(!this._started, 'Cannot register systems after the game was started.')\n\n    const query = unifyQuery(system.query)\n\n    this._systems.push({\n      query,\n      on: system.on || 'tick',\n      process: system.process || createProcess(system.processEntity)\n    })\n\n    forEach(\n      query.subQueries,\n      subQuery => this._queries.push(subQuery)\n    )\n  }\n\n  start (init) {\n    assert(!this._started, 'A game can only be started once!')\n    this._started = true\n\n    init(this._proxy)\n\n    this._onTick(timeDelta => this._update(timeDelta))\n  }\n\n  _update (timeDelta) {\n    this._time += timeDelta\n    this._events.clear()\n    this._emit('tick')\n    forEach(this._systems, system => this._runSystem(system))\n  }\n\n  _runSystem (system, timeDelta) {\n    forEach(\n      this._events.get(system.on),\n      event => {\n        this._handleChanges()\n        system.process(system.query.entities, event, this._proxy)\n      }\n    )\n  }\n\n  _handleChanges () {\n    forEach2(this._changed, this._queries, handleEntityChange)\n    this._changed.length = 0\n\n    forEach2(this._removed, this._queries, handleEntityRemove)\n    this._removed.length = 0\n  }\n\n  _createEntity (assemblage) {\n    assert(this._started, 'Entities cannot be created before the game is started.')\n    const entity = new Entity(this._componentCount, this._onEntityChange)\n    if (assemblage) {\n      assemblage(entity)\n    }\n    return entity\n  }\n\n  _removeEntity (entity) {\n    assert(this._started, 'Entities cannot be removed before the game is started.')\n    this._removed.push(entity)\n  }\n\n  _emit (event) {\n    this._events.emit(event, this._time)\n  }\n}\n\nfunction createProcess (processEntity) {\n  return function (entities, event, game) {\n    for (let i = 0; i < entities.length; ++i) {\n      processEntity(entities[i], event, game)\n    }\n  }\n}\n\nfunction handleEntityChange (entity, query) {\n  query.onChange(entity)\n}\n\nfunction handleEntityRemove (entity, query) {\n  query.onRemove(entity)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Game.js","export { Game } from './Game'\nexport { Query } from './Query'\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js"],"sourceRoot":""}