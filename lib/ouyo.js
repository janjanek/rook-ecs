!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.OUYO={})}(this,function(t){"use strict";var e=0,n=function(){function t(t){this._components=Object.create(null),this._changeRegistered=!1,this.id=e++,this._registerChange=t}return t.prototype.add=function(t){if(null==t)throw new Error("Entity.add :: Argument is not a component instance.");var e=t.constructor;if(!e||!e.id)throw new Error("Entity.add :: Argument is not a component instance.");if(this._components[e.id])throw new Error("Entity.add :: Component class already present.");return this._components[e.id]=t,this._onChange(),this},t.prototype.has=function(t){if(!t||!t.id)throw new Error("Entity.has :: Argument is not a component class.");return!!this._components[t.id]},t.prototype.get=function(t){if(!t||!t.id)throw new Error("Entity.get :: Argument is not a component class.");var e=this._components[t.id];if(!e)throw new Error("Entity.get :: Component class not present.");return e},t.prototype.remove=function(t){if(!t||!t.id)throw new Error("Entity.remove :: Argument is not a component class.");return this._components[t.id]=void 0,this._onChange(),this},t.prototype._onChange=function(){!this._changeRegistered&&this._registerChange&&(this._registerChange(this),this._changeRegistered=!0)},t}();function i(t){t._changeRegistered=!1}var r=function(){function t(){this._events=[],this._eventTimes={}}return t.prototype.emit=function(t,e){"string"==typeof t&&(t={type:t});var n=this._eventTimes[t.type];null==n&&(n=e),t.timeDelta=e-n,this._eventTimes[t.type]=e,this._events.push(t)},t.prototype.get=function(t){return this._events.filter(function(e){return e.type===t})},t.prototype.clear=function(){this._events.length=0},t}(),o=function(){function t(t){var e=this;this._changedEntities=[],this._removedEntities=[],this._events=new r,this._onEntityChange=function(t){return e._changedEntities.push(t)},this._queries=t}return Object.defineProperty(t.prototype,"time",{get:function(){return this._time||0},enumerable:!0,configurable:!0}),t.prototype.createEntity=function(t){var e=new n(this._onEntityChange);return t&&t(e),e},t.prototype.removeEntity=function(t){this._removedEntities.push(t)},t.prototype.emit=function(t){this._events.emit(t,this._time||0)},t.prototype._internal_getEvents=function(t){return this._events.get(t)},t.prototype._internal_tick=function(t){this._time=t,this._events.clear(),this.emit("tick")},t.prototype._internal_handleChanges=function(){for(var t=0,e=this._changedEntities;t<e.length;t++){for(var n=e[t],r=0,o=this._queries;r<o.length;r++){o[r].onChange(n)}i(n)}this._changedEntities.length=0;for(var s=0,h=this._removedEntities;s<h.length;s++){n=h[s];for(var u=0,a=this._queries;u<a.length;u++){a[u].onRemove(n)}}this._removedEntities.length=0},t}();var s=function(){function t(t){if(this._entities=[],this._indexMap={},"function"!=typeof t)throw new Error("new Query :: selector must be a function");this._selector=t}return Object.defineProperty(t.prototype,"entities",{get:function(){return this._entities},enumerable:!0,configurable:!0}),t.prototype.onChange=function(t){this._selector(t)?null==this._indexMap[t.id]&&(this._indexMap[t.id]=this.entities.length,this._entities.push(t)):this.onRemove(t)},t.prototype.onRemove=function(t){var e=this._indexMap[t.id];if(null!=e){var n=this._entities.pop();n!==t&&(this._entities[e]=n,this._indexMap[n.id]=e)}},t}(),h=function(){function t(t){this._queries=t.map(function(t){return new s(t)})}return Object.defineProperty(t.prototype,"entities",{get:function(){return this._queries.map(function(t){return t.entities})},enumerable:!0,configurable:!0}),t.prototype.onChange=function(t){for(var e=0,n=this._queries;e<n.length;e++){n[e].onChange(t)}},t.prototype.onRemove=function(t){for(var e=0,n=this._queries;e<n.length;e++){n[e].onRemove(t)}},t}();function u(t){var e,n,i=function(t){return!t.process}(t)?(e=t.processEntity,function(t,n,i){for(var r=0,o=t;r<o.length;r++){var s=o[r];e(s,n,i)}}):t.process;return{query:t.query&&(n=t.query,Array.isArray(n)?new h(n):new s(n)),on:t.on||"tick",process:i}}var a=function(){function t(t,e){this._systems=[],this._systems=t.map(u),this._world=new o(this._systems.map(function(t){return t.query}).filter(function(t){return!!t})),e&&e(this._world)}return t.prototype.update=function(t){this._world._internal_tick(t);for(var e=0,n=this._systems;e<n.length;e++)for(var i=n[e],r=0,o=this._world._internal_getEvents(i.on);r<o.length;r++){var s=o[r];this._world._internal_handleChanges();var h=i.query?i.query.entities:[];i.process(h,this._world,s)}},t.prototype.start=function(){var t=this,e=function(){requestAnimationFrame(e),t.update(Date.now()/1e3)};e()},t}();function c(t){return t&&t.id}t.Game=a,t.hasAll=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!t.every(c))throw new Error("hasAll :: All arguments must be components.");return function(e){return t.every(function(t){return e.has(t)})}},t.hasAny=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!t.every(c))throw new Error("hasAny :: All arguments must be components.");return function(e){return t.some(function(t){return e.has(t)})}},t.Entity=n,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ouyo.js.map
