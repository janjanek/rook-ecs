!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("OUYO",[],t):"object"==typeof exports?exports.OUYO=t():e.OUYO=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._events=[],this._eventTimes={}}return r(e,[{key:"emit",value:function(e,t){"string"==typeof e&&(e={type:e});var n=null!=this._eventTimes[e.type]?this._eventTimes[e.type]:t;e.timeDelta=t-n,this._eventTimes[e.type]=t,this._events.push(e)}},{key:"get",value:function(e){return this._events.filter(function(t){return t.type===e})}},{key:"clear",value:function(){this._events.length=0}}]),e}();function o(e,t){if(!e)throw new Error(t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o("function"==typeof t,"new Query :: selector must be a function"),this._selector=t,this.entities=new Set}return a(e,[{key:"onChange",value:function(e){this._selector(e)?this.entities.add(e):this.entities.delete(e)}},{key:"onRemove",value:function(e){this.entities.delete(e)}}]),e}(),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._components=Object.create(null),this._changeRegistered=!1,this._registerChange=t}return s(e,[{key:"add",value:function(e){o(null!=e,"Entity.add :: Argument is not a component instance.");var t=e.constructor;return o(t&&t.id,"Entity.add :: Argument is not a component instance."),o(!this._components[t.id],"Entity.add :: Component already present."),this._components[t.id]=e,this._onChange(),this}},{key:"has",value:function(e){return o(e&&e.id,"Entity.has :: Argument is not a component."),!!this._components[e.id]}},{key:"get",value:function(e){o(e&&e.id,"Entity.get :: Argument is not a component.");var t=this._components[e.id];return o(t,"Entity.get :: Component not present."),t}},{key:"remove",value:function(e){return o(e&&e.id,"Entity.remove :: Argument is not a component."),this._components[e.id]=void 0,this._onChange(),this}},{key:"_onChange",value:function(){this._changeRegistered||this._registerChange(this),this._changeRegistered=!0}},{key:"_onChangeRegistered",value:function(){this._changeRegistered=!1}}]),e}(),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._game=t}return l(e,[{key:"createEntity",value:function(e){var t=new c(this._game._onEntityChange);return e&&e(t),t}},{key:"removeEntity",value:function(e){this._game._removedEntities.push(e)}},{key:"emit",value:function(e){this._game._events.emit(e)}}]),e}(),h=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var y=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._systems=[],this._queries=[],this._events=new i,this._changedEntities=[],this._removedEntities=[],this._onEntityChange=function(e){return t._changedEntities.push(e)},this._time=null,this._world=new f(this)}return h(e,[{key:"registerSystems",value:function(e){this._systems=e.map(function(e){return{query:e.query&&new u(e.query),on:e.on||"tick",process:e.process||(t=e.processEntity,function(e,n,r){var i=!0,o=!1,a=void 0;try{for(var u,s=e[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var c=u.value;t(c,n,r)}}catch(e){o=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw a}}})};var t}),this._queries=this._systems.map(function(e){return e.query}).filter(function(e){return!!e})}},{key:"init",value:function(e,t){o(null===this._time,"Game.init :: Game can only be initialized once."),this._time=e,t(this._world)}},{key:"update",value:function(e){var t=e-this._time;this._time=e,this._events.clear(),this._events.emit("tick",this._time),this._runSystems(t)}},{key:"_runSystems",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=this._systems[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value,u=!0,s=!1,c=void 0;try{for(var l,f=this._events.get(a.on)[Symbol.iterator]();!(u=(l=f.next()).done);u=!0){var h=l.value;this._handleChanges(),a.process(a.query&&a.query.entities,h,this._world)}}catch(e){s=!0,c=e}finally{try{!u&&f.return&&f.return()}finally{if(s)throw c}}}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"_handleChanges",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this._changedEntities[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value,a=!0,u=!1,s=void 0;try{for(var c,l=this._queries[Symbol.iterator]();!(a=(c=l.next()).done);a=!0){c.value.onChange(o)}}catch(e){u=!0,s=e}finally{try{!a&&l.return&&l.return()}finally{if(u)throw s}}o._onChangeRegistered()}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}this._changedEntities.length=0;var f=!0,h=!1,y=void 0;try{for(var v,m=this._removedEntities[Symbol.iterator]();!(f=(v=m.next()).done);f=!0){var d=v.value,p=!0,_=!1,g=void 0;try{for(var b,w=this._queries[Symbol.iterator]();!(p=(b=w.next()).done);p=!0){b.value.onRemove(d)}}catch(e){_=!0,g=e}finally{try{!p&&w.return&&w.return()}finally{if(_)throw g}}}}catch(e){h=!0,y=e}finally{try{!f&&m.return&&m.return()}finally{if(h)throw y}}this._removedEntities.length=0}}]),e}();function v(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return o(t.every(d),"hasAll :: All arguments must be components."),function(e){return t.every(function(t){return e.has(t)})}}function m(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return o(t.every(d),"hasAny :: All arguments must be components."),function(e){return t.some(function(t){return e.has(t)})}}function d(e){return e&&e.id}n.d(t,"Game",function(){return y}),n.d(t,"hasAll",function(){return v}),n.d(t,"hasAny",function(){return m})}])});
//# sourceMappingURL=ouyo.js.map